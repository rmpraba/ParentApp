<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="..\..\bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="query-post">
  <template>
   <iron-ajax
    method="post"
    id="querypostid"
    url="{{queryposturl}}"
    params="{{querypostparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="querypostResponse"
    debounce-duration="300"
  ></iron-ajax>
  <iron-ajax
    method="post"
    id="sequenceid"
    url="{{sequenceurl}}"
    params="{{sequenceparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="sequenceResponse"
    debounce-duration="300"
  ></iron-ajax>
  <iron-ajax
    method="post"
    id="upseqid"
    url="{{upsequrl}}"
    params="{{upseqparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="upseqResponse"
    debounce-duration="300"
  ></iron-ajax>
  <iron-ajax
    method="post"
    id="getmsgid"
    url="{{getmsgurl}}"
    params="{{getmsgparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="getmsgResponse"
    debounce-duration="300"
  ></iron-ajax>
  <iron-ajax
    method="post"
    id="queryreplyid"
    url="{{queryreplyurl}}"
    params="{{queryreplyparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="queryreplyResponse"
    debounce-duration="300"
  ></iron-ajax>
   <iron-ajax
    method="post"
    id="parentinboxid"
    url="{{parentinboxurl}}"
    params="{{parentinboxparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="parentinboxResponse"
    debounce-duration="300"
  ></iron-ajax>
<iron-ajax
    method="post"
    id="managerinboxid"
    url="{{managerinboxurl}}"
    params="{{managerinboxparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="managerinboxResponse"
    debounce-duration="300"
  ></iron-ajax>
  <iron-ajax
    method="post"
    id="updatefwdid"
    url="{{updatefwdurl}}"
    params="{{updatefwdparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="updatefwdResponse"
    debounce-duration="300"
  ></iron-ajax>
<iron-ajax
    method="post"
    id="openreportid"
    url="{{openreporturl}}"
    params="{{openreportparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="openreportResponse"
    debounce-duration="300"
  ></iron-ajax>
  <iron-ajax
    method="post"
    id="closereportid"
    url="{{closereporturl}}"
    params="{{closereportparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="closereportResponse"
    debounce-duration="300"
  ></iron-ajax>
   <iron-ajax
    method="post"
    id="upmsgstatid"
    url="{{upmsgstaturl}}"
    params="{{upmsgstatparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="upmsgstatResponse"
    debounce-duration="300"
  ></iron-ajax>
   <iron-ajax
    method="post"
    id="unreadmsgid"
    url="{{unreadmsgurl}}"
    params="{{unreadmsgparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="unreadmsgResponse"
    debounce-duration="300"
  ></iron-ajax>
  <iron-ajax
    method="post"
    id="unopenmsgid"
    url="{{unopenmsgurl}}"
    params="{{unopenmsgparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="unopenmsgResponse"
    debounce-duration="300"
  ></iron-ajax>
  <iron-ajax
    method="post"
    id="upmsgstatprid"
    url="{{upmsgstatprurl}}"
    params="{{upmsgstatprparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="upmsgstatprResponse"
    debounce-duration="300"
  ></iron-ajax>
  <iron-ajax
    method="post"
    id="uppriid"
    url="{{uppriurl}}"
    params="{{uppriparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="uppriResponse"
    debounce-duration="300"
  ></iron-ajax>

  <iron-ajax
    method="post"
    id="summaryreportid"
    url="{{summaryreporturl}}"
    params="{{summaryreportparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="summaryreportResponse"
    debounce-duration="300"
  ></iron-ajax>
<!-- verify the registered number for new registration -->
   <iron-ajax
    method="post"
    id="verifymobid"
    url="{{verifymoburl}}"
    params="{{verifymobparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="verifymobResponse"
    debounce-duration="300"
  ></iron-ajax>
<!-- submit the new registration details for helpdesk -->
  <iron-ajax
    method="post"
    id="regmobid"
    url="{{regmoburl}}"
    params="{{regmobparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="regmobResponse"
    debounce-duration="300"
  ></iron-ajax>
  <iron-ajax
    method="post"
    id="regmailajax"
    url="{{regmailurl}}"
    params="{{regmailparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="regmailResponse"
    debounce-duration="300"
  ></iron-ajax>
  <iron-ajax
    method="post"
    id="teacherinboxid"
    url="{{teacherinboxurl}}"
    params="{{teacherinboxparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="teacherinboxResponse"
    debounce-duration="300"
  ></iron-ajax>
  <iron-ajax
    method="post"
    id="unreadmsgteacherid"
    url="{{unreadmsgteacherurl}}"
    params="{{unreadmsgteacherparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="unreadmsgteacherResponse"
    debounce-duration="300"
  ></iron-ajax>
    <iron-ajax  
        id="roleajax"
        url="{{roleurl}}"
        handle-as="json"
        content-type="application/json"
        on-response="roleResponse"
        debounce-duration="300"
        >
  </iron-ajax>
    <iron-ajax  
        method="post"
        id="schoolwisereport"
        url="{{schoolwisereporturl}}"
        handle-as="json"
        content-type="application/json"
        on-response="schoolwisereportResponse"
        debounce-duration="300"
        >
  </iron-ajax>
  <iron-ajax
    method="post"
    id="classwisereport"
    url="{{classwisereporturl}}"
    params="{{classwisereportparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="classwisereportResponse"
    debounce-duration="300"
  ></iron-ajax>
  <iron-ajax
    method="post"
    id="timeofadminreadid"
    url="{{timeofadminreadurl}}"
    params="{{timeofadminreadparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="timeofadminreadResponse"
    debounce-duration="300"
  ></iron-ajax>
<iron-ajax
    method="post"
    id="sentmsgid"
    url="{{sentmsgurl}}"
    params="{{sentmsgparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="sentmsgResponse"
    debounce-duration="300"
  ></iron-ajax>
<iron-ajax
    method="post"
    id="upsupmsgstatid"
    url="{{upsupmsgstaturl}}"
    params="{{upsupmsgstatparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="upsupmsgstatResponse"
    debounce-duration="300"
  ></iron-ajax>
<iron-ajax
    method="post"
    id="supstatcountid"
    url="{{supstatcounturl}}"
    params="{{supstatcountparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="supstatcountResponse"
    debounce-duration="300"
  ></iron-ajax>
  <iron-ajax
    method="post"
    id="checkstatusid"
    url="{{checkstatusurl}}"
    params="{{checkstatusparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="checkstatusResponse"
    debounce-duration="300"
  ></iron-ajax>
  <iron-ajax
    method="post"
    id="ratingajax"
    url="{{ratingurl}}"
    params="{{ratingparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="ratingResponse"
    debounce-duration="300"
  ></iron-ajax>
    <iron-ajax
    method="post"
    id="catereportajax"
    url="{{catereporturl}}"
    params="{{catereportparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="catereportResponse"
    debounce-duration="300"
  ></iron-ajax>
  <iron-ajax
    method="post"
    id="feedcheckajax"
    url="{{feedcheckurl}}"
    params="{{feedcheckparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="feedcheckResponse"
    debounce-duration="300"
  ></iron-ajax>
    <style>
      :host {
        display: block;
      }
    </style>
    <div></div>
  </template>
  <script>
  (function() {
    'use strict';
    var stud_id;
    var sname;
    var semail;
    var scat;
    var scomplaint;
    var sub="";
    var mobile;
    var stid;
    var inboxlen;
    var inboxcount;
    var resarr;
    var startcount;
    var regnewno;
    var regusername;
    var regvericode;
    var regrelation;
    var fwd;
    var rep;
    var queryy_id;
    var reply;
    Polymer({
      is: 'query-post',
      
      checkstatus:function(){
        //alert('hai......sdgfva');
          this.checkstatusurl=sessionStorage.getItem("haddrinfo")+"/checkstatus";
        var obj={"stid":"","schol":""}
        obj.stid=sessionStorage.getItem("studid");
        obj.schol=sessionStorage.getItem("schoolx");
        this.checkstatusparam=obj;
        this.$.checkstatusid.generateRequest();
      },
      checkstatusResponse:function(e){
        //alert('fnjjv...  '+JSON.stringify(e.detail.response.returnval));
        var res=e.detail.response.returnval[0].total;
        document.querySelector('complaint-form').values=res;
      },
      feedcheck:function(){
        var boj={"schol":"","studid":"","status":"","feedback":""}
        boj.schol=sessionStorage.getItem("schoolx");
        boj.studid=sessionStorage.getItem("studid");
        boj.status="closed";
        boj.feedback=0;
        this.feedcheckparam=boj;
        this.feedcheckurl=sessionStorage.getItem("haddrinfo")+"/feedcheck";
        this.$.feedcheckajax.generateRequest();
      },
      feedcheckResponse:function(e){
          var res=e.detail.response.returnval;
          var tak='take';
          if(res==0){
              document.querySelector('complaint-form').statfeed=tak;    
          }
          else{
            var ans=e.detail.response.returnval[0].query_id;
             document.querySelector('complaint-form').statfeed=ans;     
          }
      },
      querypostFn:function(student_id,name,email,category,complaint,mob){
        //alert('hai');
        stud_id=student_id;
        sname=name;
        semail=email;
        scat=category;
        scomplaint=complaint;
        mobile=mob;


        var obj={"school_id":""};
        obj.school_id=sessionStorage.getItem("schoolx");
        this.sequenceurl=sessionStorage.getItem("haddrinfo")+"/query-sequence";
        this.sequenceparam=obj;
        this.$.sequenceid.generateRequest();
        
      },
      
sequenceResponse:function(e){
  var d1=new Date();
  var datex=d1.getDate()+'/'+(d1.getMonth()+1)+'/'+d1.getFullYear();
  var h =  d1.getHours(), m = d1.getMinutes();
    var thistime = (h > 12) ? (h-12 + ':' + m +' PM') : (h + ':' + m +' AM');
  //alert(JSON.stringify(e.detail.response.returnval));
  var seq=e.detail.response.returnval[0].sequenceno;
  var obj={"student_id":"","date":"","time":"","name":"","email":"","category":"","complaint":"","queryid":"","flag":"","subject":"","mob":"","msq_status":"","priority":""};
        obj.school_id=sessionStorage.getItem("schoolx");
        obj.query_id='PKT1600'+seq;
        obj.student_id=stud_id;
        obj.name=sname;
        obj.email=semail;
        obj.category=scat;
        obj.complaint=scomplaint;
        obj.date=datex;
        obj.time=thistime;
        obj.flag=1;
        obj.status="open";
        obj.subject=sub;
        obj.mob=mobile;
        obj.msq_status=1;
        obj.priority="Moderate";
        this.queryposturl=sessionStorage.getItem("haddrinfo")+"/query-post1";
        this.querypostparam=obj;
       this.$.querypostid.generateRequest()
       var obj1={"school_id":"","sequence":""}
       obj1.school_id=sessionStorage.getItem("schoolx");
       obj1.sequence=parseInt(seq)+1;
       this.upsequrl=sessionStorage.getItem("haddrinfo")+"/upquery-sequence";
       this.upseqparam=obj1;
       this.$.upseqid.generateRequest();
},
querypostResponse:function(e)
{ 
  var usern=sessionStorage.getItem("user");
  var s=e.detail.response.returnval;
  if(s=='success'){
    if(usern=='parent'){
      document.querySelector('complaint-form').refresh(); 
      document.querySelector('transport-app').setPage('feedbacksubmited'); 
    } else if (usern=='admin') {
      reply="Reply sent";
      document.querySelector('parent-inbox-card').dialogshow(reply); 
    } else {
      reply="Feedback Submited";
      document.querySelector('complaint-form').dialogshow(reply);
    }
  } else {
    reply="Feedback not submited";
    document.querySelector('complaint-form').dialogshow(reply);
  }
},
getmsg:function(){
  this.getmsgurl=sessionStorage.getItem("haddrinfo")+"/getmsg";
  var obj={"schol":"","status":"","userid":""}
  obj.schol=sessionStorage.getItem("schoolx");
  obj.userid=sessionStorage.getItem("role");
  this.getmsgparam=obj;
  //alert(JSON.stringify(obj));
  this.$.getmsgid.generateRequest();
  this.unopenmsgurl=sessionStorage.getItem("haddrinfo")+"/unopenmsg";
  var obj={"schol":"","status":"","userid":""}
  obj.schol=sessionStorage.getItem("schoolx");
  obj.userid=sessionStorage.getItem("role");
  obj.status=1;
  this.unopenmsgparam=obj;
  //alert(JSON.stringify(obj));
  this.$.unopenmsgid.generateRequest();
  var id=sessionStorage.getItem("user");
  var role=sessionStorage.getItem("role");
  this.roleurl="../../configfile/roles.json";
  this.$.roleajax.generateRequest();
},
 roleResponse:function(e){
      var role=sessionStorage.getItem("role");
        //alert(e.detail.response);
        var xx=e.detail.response;
        for(var i=0;i<xx.length;i++){
          //alert(i);
          var us=JSON.stringify(xx[i].user);
          //alert(i+'      '+us+'     '+role);
          if(xx[i].user==role){
            //alert('role '+i);
            fwd=e.detail.response[i].frwd;
            rep=e.detail.response[i].reply;
          }
        }
       sessionStorage.setItem("frwd",fwd);
       sessionStorage.setItem("reply",rep);
    },
getmsgResponse:function(e){
  resarr=e.detail.response.returnval;
  inboxlen=e.detail.response.returnval.length;
  //alert(inboxlen);
  if(resarr=="invalid")
  {
    document.querySelector('parent-inbox').showNomsg();
  }
  var inbox=resarr.slice(0,5);
  inboxcount=5;
  document.querySelector('parent-inbox').msgarr=inbox;
  //var msgarr=e.detail.response.returnval;
  //document.querySelector('parent-inbox').msgarr=msgarr;
  //alert(JSON.stringify(msgarr));
},
postreply:function(queryid,reply,statusx,date,time){
   var d1=new Date();
  var datex=d1.getDate()+'/'+(d1.getMonth()+1)+'/'+d1.getFullYear();
  var h =  d1.getHours(), m = d1.getMinutes();
    var thistime = (h > 12) ? (h-12 + ':' + m +' PM') : (h + ':' + m +' AM');
  this.queryposturl=sessionStorage.getItem("haddrinfo")+"/querypost";
  var obj={"id":"","msg":"","schol":"","msg_status":"","replydate":"","replytime":"","status":"","flag":"","date":"","time":"","roles":""}
  obj.id=queryid;
  obj.msg=reply;
  obj.replydate=datex;
  obj.replytime=thistime;
  obj.status=statusx;
  obj.date=date;
  obj.time=time;
  obj.schol=sessionStorage.getItem("schoolx");
  obj.msg_status=1;
  obj.roles=sessionStorage.getItem("role");
  this.querypostparam=obj;
  this.$.querypostid.generateRequest();
},

parentinbox:function(){
       // alert('1');
this.parentinboxurl=sessionStorage.getItem("haddrinfo")+"/parentinbox";
var obj={"id":"","schol":""}
obj.id=sessionStorage.getItem("studid");
obj.schol=sessionStorage.getItem("schoolx");
this.parentinboxparam=obj;
this.$.parentinboxid.generateRequest();

this.unreadmsgurl=sessionStorage.getItem("haddrinfo")+"/unreadmsg";
  var obj={"sid":"","schol":"","status":""}
  obj.sid=sessionStorage.getItem("studid");
  obj.schol=sessionStorage.getItem("schoolx");
  obj.status=1;
  this.unreadmsgparam=obj;
  this.$.unreadmsgid.generateRequest();
},
parentinboxResponse:function(e){

 resarr=e.detail.response.returnval;
  inboxlen=e.detail.response.returnval.length;
  if(resarr=="invalid")
  {
    document.querySelector('parentinbox-itemcard').showNomsg();
  }
  //alert(resarr);
  var inbox=resarr.slice(0,5);
  inboxcount=5;
  //alert(JSON.stringify(resarr));
  document.querySelector('parentinbox-itemcard').msgarr=inbox;
},
teacherinbox:function(){
  this.teacherinboxurl=sessionStorage.getItem("haddrinfo")+"/teacherinbox";
  var obj={"id":"","schol":"","status":""}
  obj.id=sessionStorage.getItem("userid");
  obj.schol=sessionStorage.getItem("schoolx");
  obj.status="closed";
  //alert(JSON.stringify(obj));
  this.teacherinboxparam=obj;
  this.$.teacherinboxid.generateRequest();

  this.unreadmsgteacherurl=sessionStorage.getItem("haddrinfo")+"/unreadmsgteacher";
  var obj={"sid":"","schol":"","status":""}
  obj.sid=sessionStorage.getItem("userid");
  obj.schol=sessionStorage.getItem("schoolx");
  obj.status=1;
  this.unreadmsgteacherparam=obj;
  this.$.unreadmsgteacherid.generateRequest();
},
teacherinboxResponse:function(e){
  resarr=e.detail.response.returnval;
  //alert(JSON.stringify(resarr));
  inboxlen=e.detail.response.returnval.length;
  if(resarr=="invalid")
  {
    document.querySelector('parentinbox-itemcard').showNomsg();
  }
  //alert(resarr);
  var inbox=resarr.slice(0,5);
  inboxcount=5;
  //alert(JSON.stringify(resarr));
  document.querySelector('parentinbox-itemcard').msgarr=inbox;
},
unreadmsgteacherResponse:function(e){
  var resno=e.detail.response.returnval[0].total;
  document.querySelector('icon-card').unread=resno;
  //alert('total parent unread msg for this id is'+JSON.stringify(resno));
},
Fnmoveforward:function()
{
  //alert(inboxcount+''+inboxlen);
if(inboxlen>inboxcount)
{
  //alert('t');
  var inbox=resarr.slice(inboxcount,inboxcount+5);
  if(inboxcount+5<=inboxlen)
  {
    startcount=inboxcount;
  
  inboxcount+=5;
}
else
{
  startcount=inboxcount;
  inboxcount=inboxlen;
}
  document.querySelector('parentinbox-itemcard').msgarr=inbox;
}
},
Fnmovebackward:function()
{
 // alert(inboxcount);
if(inboxcount>0)
{
  //alert('tt');
  var inbox=resarr.slice(startcount-5,startcount);
  if(startcount-5>0)
  {
  startcount-=5;
  inboxcount-=5;
  }
  else
  {
  startcount=0;
  inboxcount=0;
 }
  document.querySelector('parentinbox-itemcard').msgarr=inbox;
}

},

postquery:function(queryid,reply,status,flag,id,par,mail,category,mobile){
    var d1=new Date();
  var datex=d1.getDate()+'/'+(d1.getMonth()+1)+'/'+d1.getFullYear();
  var h =  d1.getHours(), m = d1.getMinutes();
    var thistime = (h > 12) ? (h-12 + ':' + m +' PM') : (h + ':' + m +' AM');
    var obj={"schoolid":"","queryid":"","name":"","complaint":"","date":"","time":"","status":"","flag":"","category":"","mob":"","msq_status":"","priority":""}
    obj.school_id=sessionStorage.getItem("schoolx");
    obj.query_id=queryid;
    obj.complaint=reply;
    obj.date=datex;
    obj.time=thistime;
    obj.status=status;
    obj.flag=flag;
    obj.student_id=id;
    obj.name=par;
    obj.email=mail;
    obj.category=category;
    obj.mob=mobile;
    obj.msq_status=1;
    obj.priority="Moderate";
    this.queryposturl=sessionStorage.getItem("haddrinfo")+"/query-post1";
        this.querypostparam=obj;
       // alert(JSON.stringify(obj));
       this.$.querypostid.generateRequest();
},
managerinbox:function(){
       // alert('1'+sessionStorage.getItem("role"));
this.managerinboxurl=sessionStorage.getItem("haddrinfo")+"/managerinbox";
var obj={"schol":"","frwd":""}
  obj.schol=sessionStorage.getItem("schoolx");
  
  obj.frwd=sessionStorage.getItem("role");
  //alert(JSON.stringify(obj));
this.managerinboxparam=obj;
this.$.managerinboxid.generateRequest();

this.roleurl="../../configfile/roles.json";
          this.$.roleajax.generateRequest();
},
managerinboxResponse:function(e){
  //alert('2');
   var msgarr=e.detail.response.returnval;
   if(msgarr.length!=0){
  document.querySelector('parent-inbox').msgarr=msgarr;
   }
   else{
    document.querySelector('parent-inbox').nomsg();
}
  //alert(JSON.stringify(msgarr));
},
updatefrwd:function(querid,msg,date,time){
  this.updatefwdurl=sessionStorage.getItem("haddrinfo")+"/updatefwd";
  var obj={"id":"","date":"","time":"","comments":"","frwd":"","schol":"","roles":""}
  obj.id=querid;
  obj.date=date;
  obj.comments=msg;
  obj.time=time;
  obj.frwd=sessionStorage.getItem("frwd");
  obj.roles=sessionStorage.getItem("role");
  obj.schol=sessionStorage.getItem("schoolx");
  this.updatefwdparam=obj;
  //alert(JSON.stringify(obj));
  this.$.updatefwdid.generateRequest();
},
updatefwdResponse:function(e){
  var res=e.detail.response.returnval;
  var user=sessionStorage.getItem("role");
  if(res=='success'){
      if(user=='principal'){
          reply='Escalated to Management';
          document.querySelector('parent-inbox-card').showdialog(reply);
      }
      else if(user=='Transport'){
          reply='Escalated to Management';
          document.querySelector('parent-inbox-card').showdialog(reply);
      }
      else{
           reply='Escalated to Principal';
          document.querySelector('parent-inbox-card').showdialog(reply);
      }
    }
  else{
   reply='Not Forwarded'; 
          document.querySelector('parent-inbox-card').showdialog(reply);
  }
},
getreport:function(){
this.openreporturl=sessionStorage.getItem("haddrinfo")+"/openreport";
var obj={"schol":"","status":"","role":""}
obj.schol=sessionStorage.getItem("schoolx");
obj.role=sessionStorage.getItem("role");
obj.status="open";
obj.flag=1;
this.openreportparam=obj;
this.$.openreportid.generateRequest();

this.closereporturl=sessionStorage.getItem("haddrinfo")+"/closereport";
var obj1={"schol":"","status":""}
obj1.schol=sessionStorage.getItem("schoolx");
obj.role=sessionStorage.getItem("role");
obj1.status="closed";
obj1.flag=1;
this.closereportparam=obj1;
this.$.closereportid.generateRequest();

},
openreportResponse:function(e){
  var date=new Date();
  var date2;
  var days;
  var zxarr=[];
  var cp=0,mp=0,lp=0;
  if(e.detail.response.returnval!=0){
  var tex=e.detail.response.returnval;

var len=tex.length;
for(var i=0;i<len;i++){
  //alert('1'+tex[0].priority);

  if(tex[i].priority=='Critical'){
    cp++;
  }
  else if(tex[i].priority=='Moderate'){
    mp++;
    //alert('1'+mp);
  }
  else if(tex[i].priority=='Low'){
    lp++;
  }
  date2=new Date(tex[i].datetime);
  days=date.getDate() - date2.getDate();
 // alert(days);
  var obj={"query_id":"","priority":"","datetime":"","parent_email":"","mobile":"","subject":"","parent_name":"","days":""}
  obj.query_id=tex[i].query_id;
  obj.priority=tex[i].priority;
  obj.datetime=tex[i].datetime;
  obj.parent_email=tex[i].parent_email;
  obj.parent_name=tex[i].parent_name;
  obj.mobile=tex[i].mobile;
  obj.subject=tex[i].subject;
  obj.days=days;
//alert(JSON.stringify(obj));  
zxarr.push(obj);
}
//alert(JSON.stringify(zxarr));
document.querySelector('reportstatus-card').pendingarr=zxarr;
//document.querySelector('reportstatus-card').noofcricpend=cp;
document.querySelector('reportstatus-card').noofmodpend=mp;
document.querySelector('reportstatus-card').nooflowpend=lp;
document.querySelector('reportstatus-card').noofpend=len;
}
},
closereportResponse:function(e){
  var date=new Date();
  var date2;
  var days;
  var zxarr=[];
  var cc=0,mc=0,lc=0;
  if(e.detail.response.returnval!=0){
  var tex=e.detail.response.returnval; 

  //alert(JSON.stringify(tex)); 
  var len=tex.length;
  for(var i=0;i<len;i++){
  if(tex[0].priority=='Critical'){
    cc++;
  }
  else if(tex[0].priority=='Moderate'){
    mc++;
  }
  else if(tex[0].priority=='Low'){
    lc++;
  }
  var read = tex[i].time_of_admin_read;
  var close = tex[i].reply_date;
  var from = read.split("/");
  var to = close.split("/");
  var readdate = new Date(from[2], from[1] - 1, from[0]);
  var closeddate = new Date(to[2], to[1] - 1, to[0]);
  var diffDays = closeddate.getDate() - readdate.getDate();
  date2=new Date(tex[i].datetime);
  days=date.getDate() - date2.getDate();
  //alert(days);
  var obj={"query_id":"","priority":"","datetime":"","parent_email":"","mobile":"","subject":"","parent_name":"","days":"", "timetaken": ""}
  obj.query_id=tex[i].query_id;
  obj.priority=tex[i].priority;
  obj.datetime=tex[i].datetime;
  obj.parent_email=tex[i].parent_email;
  obj.parent_name=tex[i].parent_name;
  obj.mobile=tex[i].mobile;
  obj.subject=tex[i].subject;
  obj.days=days;
  obj.timetaken = diffDays;
//alert(JSON.stringify(obj));  
zxarr.push(obj);
}
//document.querySelector('reportstatus-card').noofcricclose=cc;
document.querySelector('reportstatus-card').noofmodclose=mc;
document.querySelector('reportstatus-card').nooflowclose=lc;
document.querySelector('reportstatus-card').closedarr=zxarr;
document.querySelector('reportstatus-card').noofclose=len;
}
},
upmsgstat:function(id,sid,time,date){
  queryy_id = id;

    var todaydate=new Date();
    var dd = todaydate.getDate();
    var mon = todaydate.getMonth();
    var year = todaydate.getFullYear();
    var chdate = dd+"/"+mon+"/"+year;
    this.timeofadminreadurl=sessionStorage.getItem("haddrinfo")+"/timeofadminread";
    var obj={"sid":"","msg_status":"","schol":"", "admin_reads_message":"" }
    obj.sid=queryy_id;
    obj.schol=sessionStorage.getItem("schoolx");
    obj.admin_reads_message= chdate;
    obj.msg_status=1;
    this.timeofadminreadparam=obj;
    //alert(JSON.stringify(obj));
    this.$.timeofadminreadid.generateRequest();
    
  var todaydate=new Date();
  var dd = todaydate.getDate();
  var mon = todaydate.getMonth();
  var year = todaydate.getFullYear();
  var chdate = dd+"/"+mon+"/"+year;
  this.upmsgstaturl=sessionStorage.getItem("haddrinfo")+"/upmsgstat";
  var obj={"sid":"","time":"","date":"","msg_status":"","schol":"", "admin_reads_message":"" }
  obj.sid=queryy_id;
  obj.time=time;
  obj.date=date;
  obj.schol=sessionStorage.getItem("schoolx");
  obj.admin_reads_message= chdate;
  obj.msg_status=2;
  this.upmsgstatparam=obj;
  //alert(JSON.stringify(obj));
  this.$.upmsgstatid.generateRequest();
},
upmsgstatResponse:function(e){
  var res=e.detail.response.returnval;
  if(res=='success')
  {
    //alert('messaged is opened now');
  }

  this.unopenmsgurl=sessionStorage.getItem("haddrinfo")+"/unopenmsg";
  var obj={"schol":"","status":"","userid":""}
  obj.schol=sessionStorage.getItem("schoolx");
  obj.userid=sessionStorage.getItem("role");
  obj.status=1;
  this.unopenmsgparam=obj;
  //alert(JSON.stringify(obj));
  this.$.unopenmsgid.generateRequest();



},
  timeofadminreadResponse:function(e){
    var res = e.detail.response.returnval;
    if(res == 'success'){
      //alert('time changed');
    }
  },
unopenmsgResponse:function(e)
{
  var resno=e.detail.response.returnval[0].total;
  document.querySelector('icon-card').unread=resno;
  //alert(resno);
},
upmsgstatpr:function(id,sid,time,date){
    stid=sid;
this.upmsgstatprurl=sessionStorage.getItem("haddrinfo")+"/upmsgstatpr";
var obj={"sid":"","time":"","date":"","msgstatus":"","schol":""}
obj.sid=id;
obj.time=time;
obj.date=date;
obj.msgstatus=2;
obj.schol=sessionStorage.getItem("schoolx");


this.upmsgstatprparam=obj;
//alert('parent reply  '+JSON.stringify(obj));
this.$.upmsgstatprid.generateRequest();

},
upmsgstatprResponse:function(e){
  var res=e.detail.response.returnval;
  if(res=='success')
  {
    //alert('parent messaged is opened now');
  }

  this.unreadmsgurl=sessionStorage.getItem("haddrinfo")+"/unreadmsg";
  var obj={"sid":"","schol":"","status":""}
  obj.sid=stid;
  obj.schol=sessionStorage.getItem("schoolx");
  obj.status=1;
  this.unreadmsgparam=obj;
  //alert(JSON.stringify(obj));
  this.$.unreadmsgid.generateRequest();
},
unreadmsgResponse:function(e){
  var resno=e.detail.response.returnval[0].total;
   document.querySelector('icon-card').unread=resno;
  //alert('total parent unread msg for this id is'+JSON.stringify(resno));
},
uppri:function(level,qid,date,time){
this.uppriurl=sessionStorage.getItem("haddrinfo")+"/uppri";
var obj={"queryid":"","level":"","date":"","time":"","schol":""}
obj.queryid=qid;
obj.level=level;
obj.date=date;
obj.time=time;
obj.schol=sessionStorage.getItem("schoolx");
this.uppriparam=obj;
this.$.uppriid.generateRequest();
},
uppriResponse:function(e){
  var res=e.detail.response.returnval;
  if(res=='success'){
     document.querySelector('parent-inbox-card').prioreply();
  }
},
FnFetchSummaryReport:function(){
this.summaryreporturl=sessionStorage.getItem("haddrinfo")+"/fetchsummaryreport";
this.$.summaryreportid.generateRequest();
},
summaryreportResponse:function(e){
// alert(JSON.stringify(e.detail.response));e.detail.response
document.querySelector('issue-summary-report').summaryarr=e.detail.response.returnval;
},
verifymob:function(oldmob){
  this.verifymoburl=sessionStorage.getItem("haddrinfo")+"/verifymob";
  var obj={"exmob":""}
  obj.exmob=oldmob;
  this.verifymobparam=obj;
   //alert(JSON.stringify(obj));
  this.$.verifymobid.generateRequest();
},
verifymobResponse:function(e){
  var res=e.detail.response.returnval;
  //alert('resdf'+res);
  if(res=='0'){
    var resp='Given number is not Registered';
    document.querySelector('registration-form').showdialog(resp);
    document.querySelector('registration-form').Fnclear();
  }
},
regmob:function(regmob,username,relation,newmob,email){
  regnewno=newmob;
  regusername=username;
  regrelation=relation;

this.regmoburl=sessionStorage.getItem("haddrinfo")+"/regmob";
var obj={"regmob":"","username":"","relation":"","newmob":"","email":"","verifykey":"","activate":""}
obj.regmob=regmob;
obj.username=username;
obj.relation=relation;
obj.newmob=newmob;
obj.email=email;
obj.verifykey=Math.floor(100000 + Math.random() * 900000);
obj.activate=0;
this.regmobparam=obj;
this.$.regmobid.generateRequest();
regvericode=obj.verifykey;
},
regmobResponse:function(e){
  var res=e.detail.response.returnval;
  //alert(res);
  if(res=='success'){
    //alert('The new registration is done successfully');
    document.querySelector('registration-form').Fnclear();
    this.regmailurl=sessionStorage.getItem("haddrinfo")+"/regemailsend";
    var obj={"regmobnew":"","reguser":"","regverify":"","regrel":""}
    obj.regmobnew=regnewno;
    obj.reguser=regusername;
    obj.regverify=regvericode;
    obj.regrel=regrelation;
    this.regmailparam=obj;
    //alert(this.regmailparam);
    this.$.regmailajax.generateRequest();
    document.querySelector('app-card').setPage("login");
  }
},

  FnFetchSchoolReport:function(e){
    this.schoolwisereporturl=sessionStorage.getItem("haddrinfo")+"/schoolwisereport";
    this.$.schoolwisereport.generateRequest();
    
  },
  schoolwisereportResponse:function(e){
    document.querySelector('schoolwise-report').schoolreportarr=e.detail.response.returnval;
  },
  FnFetchClassReport:function(e){
    this.classwisereporturl=sessionStorage.getItem("haddrinfo")+"/classwisereport";
    var obj={"schol":""};
    obj.schol=sessionStorage.getItem("schoolx");
    this.classwisereportparam=obj;
    this.$.classwisereport.generateRequest();
    
  },
  classwisereportResponse:function(e){
    document.querySelector('gradewise-report').classreportarr=e.detail.response.returnval;
  },
  sentmsg:function(sid){
    this.sentmsgurl=sessionStorage.getItem("haddrinfo")+"/sentmsg";
    var obj={"schol":"","studid":""}
    obj.schol=sessionStorage.getItem("schoolx");
    obj.studid=sid;
    this.sentmsgparam=obj;
    //alert(JSON.stringify(obj));
    this.$.sentmsgid.generateRequest();
  },
  sentmsgResponse:function(e){
var res=e.detail.response.returnval;
//alert(JSON.stringify(res));
document.querySelector('sentbox-card').msgarr=res;
//document.querySelector('sentbox-itemcard').msgarr=res;
  },
  upsupmsgstat:function(id,sid,time,date){
  queryy_id = id;

    
  var todaydate=new Date();
  var dd = todaydate.getDate();
  var mon = todaydate.getMonth();
  var year = todaydate.getFullYear();
  var chdate = dd+"/"+mon+"/"+year;
  this.upsupmsgstaturl=sessionStorage.getItem("haddrinfo")+"/upsupmsgstat";
  var obj={"sid":"","time":"","date":"","msg_status":"","schol":"","role":"","admin_reads_message":"" }
  obj.sid=queryy_id;
  obj.time=time;
  obj.date=date;
  obj.schol=sessionStorage.getItem("schoolx");
  obj.role=sessionStorage.getItem("role");
  obj.read_date= chdate;
  obj.msg_status=2;
  this.upsupmsgstatparam=obj;
  //alert(JSON.stringify(obj));
  this.$.upsupmsgstatid.generateRequest();
},
supstatcount:function(){
this.supstatcounturl=sessionStorage.getItem("haddrinfo")+"/supstatcount";
    var obj={"schol":"","role":""}
    obj.schol=sessionStorage.getItem("schoolx");
    obj.role=sessionStorage.getItem("role");
    this.supstatcountparam=obj;
    //alert(JSON.stringify(obj));
    this.$.supstatcountid.generateRequest();
},
upsupmsgstatResponse:function(e){
  var res=e.detail.response.returnval;
  if(res=='success'){
    //alert('message is opened');
  }
  this.supstatcounturl=sessionStorage.getItem("haddrinfo")+"/supstatcount";
    var obj={"schol":"","role":""}
    obj.schol=sessionStorage.getItem("schoolx");
    obj.role=sessionStorage.getItem("role");
    this.supstatcountparam=obj;
    //alert(JSON.stringify(obj));
    this.$.supstatcountid.generateRequest();
},
supstatcountResponse:function(e){
var res=e.detail.response.returnval[0].total;
if(res!='0')
document.querySelector('icon-card').unread=res;
},
rating:function(queryid, rating){
  this.ratingurl=sessionStorage.getItem("haddrinfo")+"/rating";
  var obj={"schol":"","queryid":"", "rating":""};
  obj.schol=sessionStorage.getItem("schoolx");
  obj.queryid=queryid;
  obj.rating=rating;
  this.ratingparam=obj;
  this.$.ratingajax.generateRequest();
},
ratingResponse:function(e){
  var res=e.detail.response.returnval;
  if(res=='success'){
  document.querySelector('parent-inbox-card').ratingres();
document.querySelector('complaint-form').ratingres();
}
},
catereport:function(categ){
    this.catereporturl=sessionStorage.getItem("haddrinfo")+"/catereport";
    var obj={"schol":"","cate":""}
    obj.schol=sessionStorage.getItem("schoolx");
    obj.cate=categ;
    this.catereportparam=obj;
    //alert(JSON.stringify(obj));
    this.$.catereportajax.generateRequest();
},
catereportResponse:function(e){
var res=e.detail.response.returnval;
//alert(JSON.stringify(res));
document.querySelector('category-report-card').msgarr=res;
}
  });
  })();
  </script>
</dom-module>
